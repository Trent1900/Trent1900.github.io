---
title: week 2 2023
author: Trent1900
date: 2023-1-2 19:02:00 +1000
categories: [Blogging]
tags: [aws study]
---

2 Jan 2023 to 9 Jan 2023

## Weekly forecast

- Work on backend cms

> I will persist until I succeed ---by OG Mandino<!-- prettier-ignore -->
{:.prompt-tip}

### express.Router

> Use the express.Router class to create modular, mountable route handlers. A Router instance is a complete middleware and routing system; for this reason, it is often referred to as a “mini-app”.<!-- prettier-ignore -->
{:.prompt-info}

```js
const taskRouter = express.Router();
// 缺省tasks directory
taskRouter.get("", getAllTasks);
taskRouter.get("/:id", getTaskById);
taskRouter.post("", newTasks);
taskRouter.put("/:id", updateById);
taskRouter.delete("/:id", deleteById);

module.exports = taskRouter;
```

- so taskRouter is like a mini-app, because on app, we can also register the node(endpoint) and handler/middleware-function to it, only need to expose it by module.exports = taskRouter.
- as `taskRouter` is a module(function), so it can be used in `app.use('/tasks',taskRouter)`.

### middleware

1. cors
2. dotenv
   - change of dotenv file request a restart of node server, with command `rs` in console.
3. morgan
   > log the request origin, request time and so on<!-- prettier-ignore -->
{:.prompt-tip}

```js
const morgan = require("morgan");
app.use(morgan());
```

3. helmet

   > protect the header<!-- prettier-ignore -->
{:.prompt-tip}

- check with postman, header section.'x-powered-by' info will be covered.(server normally not update after deploy, with newer version released, the bugs in the previous version will become public known bugs.)

4. winston
   - control level, output directory/database/logger library.

### mongoose findOneAndUpdate()

- As the name implies, findOneAndUpdate() finds the first document that matches a given filter, applies an update, and returns the document. By default, findOneAndUpdate() returns the document as it was before update was applied.

> You should set the `new` option to `true` to return the document after `update` was applied.<!-- prettier-ignore -->
{:.prompt-tip}

> findOneAndX and findByIdAndX functions support limited validation. You can enable validation by setting the `runValidators` option.If you need full-fledged validation, use the traditional approach of first retrieving the document. 用了 findAnd 的话,validator 会不好使.想要 validator 要用传统方法,save()<!-- prettier-ignore -->
{:.prompt-tip}

```js
const doc = await Model.findById(id);
doc.name = "jason bourne";
await doc.save();
```
